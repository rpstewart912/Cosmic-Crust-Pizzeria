<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cosmic Crust Pizzeria - Customize Your Pizza">
    <title>Cosmic Crust Pizzeria - Customize Pizza</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        /* Refined Custom Pizza Page Styles */
        .customize-container {
            background-color: var(--card-bg);
            padding: 2.5rem;
            border-radius: 12px;
            margin: 3rem auto;
            max-width: 1000px;
            border: 1px solid var(--star-blue);
            box-shadow: 0 6px 20px rgba(0, 191, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 2.5rem;
        }

        .pizza-details {
            text-align: center;
            margin-bottom: 0;
            padding-bottom: 2rem;
            border-bottom: 1px dashed var(--nebula-blue);
        }

        .pizza-details h2 {
            color: var(--star-blue);
            text-shadow: 0 0 10px var(--star-blue);
            margin-bottom: 0.75rem;
            font-size: 3rem;
            letter-spacing: -0.02em;
        }

        .pizza-details p {
            font-size: 1.15rem;
            color: var(--milky-white);
            line-height: 1.7;
        }

        .customization-options {
            margin-top: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 2rem;
        }

        .customization-category {
            margin-bottom: 0;
            padding: 2rem;
            background: rgba(0, 191, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(0, 191, 255, 0.1);
            flex: 1 1 300px;
            min-width: 280px;
        }

        .customization-category h3 {
            color: var(--nebula-blue);
            margin-top: 0;
            margin-bottom: 1.25rem;
            border-bottom: 1px solid rgba(0, 191, 255, 0.2);
            padding-bottom: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            letter-spacing: -0.02em;
        }

        .option-group {
            margin-bottom: 1rem;
        }

        .option-group label {
            color: var(--milky-white);
            margin-left: 0.75rem;
            font-size: 1.1rem;
            display: inline-block;
            vertical-align: middle;
        }

        .option-group input[type="checkbox"],
        .option-group input[type="radio"] {
            accent-color: var(--star-blue);
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.75rem;
            cursor: pointer;
        }

        .option-group > div {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            flex-direction: row;
            gap: 1.25rem;
            width: fit-content;
        }

        .option-group > div > label {
            margin-left: 0;
            margin-right: 0;
            font-size: 1.1rem;
            color: var(--milky-white);
        }

        .option-group > div > input[type="radio"] {
            margin-right: 0.75rem;
            margin-left: 0;
        }

        .size-selector {
            margin-bottom: 0;
            display: flex; /* Use Flexbox to align label and select */
            flex-direction: column;
            align-items: flex-start; /* Align items to the start (top) */
        }

        .size-selector label {
            color: var(--nebula-blue);
            margin-right: 1.25rem;
            margin-bottom: 0.5rem; /* Add space between label and select */
            font-size: 1.1rem;
            font-weight: bold;
            display: inline-block;
            vertical-align: middle;
        }

        .size-selector select {
            background: rgba(0, 191, 255, 0.1);
            border: 2px solid var(--star-blue);
            color: var(--milky-white);
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 1.1rem;
            width: 100%;
            max-width: 250px;
            transition: all 0.2s ease;
        }

        .size-selector select:focus {
            outline: none;
            box-shadow: 0 0 5px rgba(0, 191, 255, 0.3);
            border-color: var(--nebula-blue);
        }

        .size-selector select option {
            background-color: var(--space-blue);
            color: var(--milky-white);
            font-size: 1.1rem;
            padding: 0.5rem;
        }

        .price-total {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid var(--star-blue);
            text-align: right;
            font-size: 2.5rem;
            color: var(--nebula-blue);
            font-weight: bold;
        }

        .price-total span {
            color: var(--star-blue);
            font-weight: bold;
        }

        .add-to-order-button {
            display: block;
            width: 100%;
            padding: 1rem;
            margin-top: 2.5rem;
            background-color: var(--star-blue);
            color: var(--space-blue);
            border: none;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 191, 255, 0.2);
        }

        .add-to-order-button:hover {
            background-color: var(--nebula-blue);
            box-shadow: 0 5px 15px rgba(0, 191, 255, 0.3);
        }

        .add-to-order-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(0, 191, 255, 0.2);
        }

        .topping-option {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            justify-content: space-between;
        }

        .topping-option input[type="checkbox"] {
            margin-right: 1rem;
            cursor: pointer;
        }

        .topping-quantity {
            display: none;
            margin-left: auto;
            align-items: center;
            gap: 0.75rem;
        }

        .topping-quantity label {
            margin: 0;
            font-size: 1.1rem;
            color: var(--milky-white);
        }

        .topping-quantity select {
            background: rgba(0, 191, 255, 0.1);
            border: 2px solid var(--star-blue);
            color: var(--milky-white);
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 1.1rem;
            width: 80px;
            transition: all 0.2s ease;
        }

        .topping-quantity select:focus{
            outline: none;
            box-shadow: 0 0 5px rgba(0, 191, 255, 0.3);
            border-color: var(--nebula-blue);
        }
    </style>
</head>
<body>
    <a class="skip-link" href="#main-content">Skip to main content</a>
    <header role="banner">
        <div class="header-container">
            <div id="account-actions"></div>
        </div>
        <img class="logo" src="https://cosmic-crust-pizzeria.uc.r.appspot.com/static/images/ccpLogo.png" alt="Cosmic Crust Pizzeria Logo">
        <nav aria-label="Main navigation" role="navigation">
            <ul>
                {# Standard Links #}
                <li><a href="/">Home</a></li>
                <li><a href="/menu">Menu</a></li>
                <li><a href="/order">Start Order/Cart<span id="cart-count">0</span></a></li>
        
                {# --- Conditional Account Link --- #}
                {% if logged_in %}
                    <li><a href="{{ url_for('account_dashboard') }}">View Account/Logout</a></li>
                {% else %}
                    <li><a href="{{ url_for('account') }}">Login/Register</a></li>
                {% endif %}
        
                {# Contact Us Link #}
                <li><a href="/contact">Contact Us</a></li>
        
                {# --- Conditional ADMIN Link (Moved After Contact Us) --- #}
                {% if is_staff %} {# Check the is_staff variable passed from Flask #}
                <li> {# Removed class="nav-admin-link" #}
                    <a href="{{ url_for('admin_menu') }}" style="color: var(--nebula-blue); font-weight: bold;">ADMIN</a>
                </li>
                {% endif %}
                {# --- End Conditional ADMIN Link --- #}
        
            </ul>
        </nav>
    </header>

    <main id="main-content" role="main" class="container">
        <div class="customize-container">
            <div class="pizza-details">
                <h2 id="custom-pizza-name">Customize Your Pizza</h2>
                <p>Start building your perfect cosmic creation from scratch!</p>
                <p>Base Price: <span id="base-price-display">$10.00</span></p>
                <div id="base-price" data-base-price="10.00"></div>
                <div id="base-item-id" data-id="custom_pizza_base"></div>
            </div>

            <div class="customization-category size-selector">
                <h3>Size</h3>
                <label for="pizza-size">Select Size:</label>
                <select id="pizza-size">
                    <option value="small" data-multiplier="1.00">Small</option>
                    <option value="medium" data-multiplier="1.25" selected>Medium</option>
                    <option value="large" data-multiplier="1.50">Large</option>
                    <option value="extra_large" data-multiplier="1.75">Extra Large</option>
                </select>
            </div>

            <div class="customization-options">
                <div class="customization-category">
                    <h3>Crust</h3>
                    <div class="option-group">
                        <div>
                            <input type="radio" id="crust-thin" name="crust" value="thin" data-price="0.00" checked>
                            <label for="crust-thin">Thin Crust ($0.00)</label>
                        </div>
                        <div>
                            <input type="radio" id="crust-thick" name="crust" value="thick" data-price="1.50">
                            <label for="crust-thick">Thick Crust ($1.50)</label>
                        </div>
                    </div>
                </div>

                <div class="customization-category">
                    <h3>Sauce</h3>
                    <div class="option-group">
                        <div>
                            <input type="radio" id="sauce-tomato" name="sauce" value="tomato" data-price="0.00" checked>
                            <label for="sauce-tomato">Tomato Sauce ($0.00)</label>
                        </div>
                        <div>
                            <input type="radio" id="sauce-pesto" name="sauce" value="pesto" data-price="1.00">
                            <label for="sauce-pesto">Pesto Sauce ($1.00)</label>
                        </div>
                    </div>
                </div>

                <div class="customization-category">
                    <h3>Cheese</h3>
                    <div class="option-group">
                        <div>
                            <input type="checkbox" id="cheese-mozzarella" name="cheese" value="mozzarella" data-price="0.00" checked>
                            <label for="cheese-mozzarella">Mozzarella ($0.00)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="cheese-cheddar" name="cheese" value="cheddar" data-price="1.00">
                            <label for="cheese-cheddar">Cheddar ($1.00)</label>
                        </div>
                    </div>
                </div>

                <div class="customization-category">
                    <h3>Toppings</h3>
                    <div class="option-group">
                        <div class="topping-option">
                            <input type="checkbox" id="topping-pepperoni" name="topping" value="pepperoni" data-price="1.50">
                            <label for="topping-pepperoni">Pepperoni ($1.50)</label>
                            <span class="topping-quantity" id="qty-pepperoni">
                                <label for="qty-pepperoni-select">Qty:</label>
                                <select id="qty-pepperoni-select" data-topping-id="pepperoni">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                </select>
                            </span>
                        </div>

                        <div class="topping-option">
                            <input type="checkbox" id="topping-mushrooms" name="topping" value="mushrooms" data-price="1.00">
                            <label for="topping-mushrooms">Mushrooms ($1.00)</label>
                            <span class="topping-quantity" id="qty-mushrooms">
                                <label for="qty-mushrooms-select">Qty:</label>
                                <select id="qty-mushrooms-select" data-topping-id="mushrooms">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                </select>
                            </span>
                        </div>

                        <div class="topping-option">
                            <input type="checkbox" id="topping-onions" name="topping" value="onions" data-price="0.75">
                            <label for="topping-onions">Onions ($0.75)</label>
                            <span class="topping-quantity" id="qty-onions">
                                <label for="qty-onions-select">Qty:</label>
                                <select id="qty-onions-select" data-topping-id="onions">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                </select>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="price-total">
                Estimated Total: <span id="estimated-total">$10.00</span>
            </div>

            <button class="add-to-order-button" data-item-name="Custom Pizza">Add to Order</button>
        </div>
    </main>

    <footer role="contentinfo">
        <address>
            Contact us at:
            <a href="tel:+11111111111" style="color: var(--star-blue);">(111) 111-1111</a><br>
            42 Cosmic Crust Avenue, Nebula City, PC 11111
        </address>
        <p style="color: var(--nebula-blue);">&copy; 2025 Cosmic Crust Pizzeria. All rights reserved.</p>
        <ul style="list-style: none; padding: 0; margin: 1rem 0; display: flex; justify-content: center; gap: 1rem;">
            <li><a href="/disclaimer" aria-label="Disclaimer" style="color: var(--star-blue);">Disclaimer</a></li>
            <li><a href="/privacy" aria-label="Privacy policy" style="color: var(--star-blue);">Privacy Policy</a></li>
        </ul>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const basePriceElement = document.getElementById('base-price');
            const estimatedTotalSpan = document.getElementById('estimated-total');
            const customizationOptionsDiv = document.querySelector('.customization-options');
            const addToOrderButton = document.querySelector('.add-to-order-button');
            const baseItemIdElement = document.getElementById('base-item-id');
            const pizzaSizeSelect = document.getElementById('pizza-size');

            let basePrice = parseFloat(basePriceElement.dataset.basePrice);
            let currentTotal = basePrice;

            function updateEstimatedTotal() {
                estimatedTotalSpan.textContent = `$${currentTotal.toFixed(2)}`;
            }

            function calculateTotal() {
                currentTotal = basePrice;

                const selectedSizeOption = pizzaSizeSelect.options[pizzaSizeSelect.selectedIndex];
                const sizeMultiplier = parseFloat(selectedSizeOption.dataset.multiplier);
                let sizePrice = basePrice * (sizeMultiplier - 1);

                currentTotal = basePrice + sizePrice;

                customizationOptionsDiv.querySelectorAll('input[type="radio"]:checked').forEach(radio => {
                    currentTotal += parseFloat(radio.dataset.price);
                });

                customizationOptionsDiv.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                    const price = parseFloat(checkbox.dataset.price);
                    const toppingId = checkbox.value;
                    const quantitySelect = document.querySelector(`#qty-${toppingId}-select`);
                    const quantity = quantitySelect ? parseInt(quantitySelect.value) : 1;

                    currentTotal += price * quantity;
                });

                updateEstimatedTotal();
            }

            customizationOptionsDiv.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
                input.addEventListener('change', calculateTotal);
            });

            pizzaSizeSelect.addEventListener('change', calculateTotal);

            customizationOptionsDiv.querySelectorAll('.topping-quantity select').forEach(select => {
                select.addEventListener('change', calculateTotal);
            });

            customizationOptionsDiv.querySelectorAll('.topping-option input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', (event) => {
                    const toppingId = event.target.value;
                    const quantitySpan = document.getElementById(`qty-${toppingId}`);
                    if (event.target.checked) {
                        quantitySpan.style.display = 'inline-block';
                        const quantitySelect = quantitySpan.querySelector('select');
                        if (quantitySelect && parseInt(quantitySelect.value) < 1) {
                            quantitySelect.value = '1';
                        }
                    } else {
                        quantitySpan.style.display = 'none';
                    }
                    calculateTotal();
                });
            });

            calculateTotal();

            addToOrderButton.addEventListener('click', () => {
                const baseItemId = baseItemIdElement.dataset.id;
                const pizzaName = document.getElementById('custom-pizza-name').textContent;
                const basePrice = parseFloat(document.getElementById('base-price').dataset.basePrice);

                const selectedSizeElement = document.getElementById('pizza-size');
                const selectedSizeOption = selectedSizeElement.options[selectedSizeElement.selectedIndex];
                const selectedSize = {
                    id: selectedSizeElement.value,
                    name: selectedSizeOption.text.split(' ($')[0],
                    multiplier: parseFloat(selectedSizeOption.dataset.multiplier)
                };

                const selectedCustomizations = {
                    size: [selectedSize]
                };

                customizationOptionsDiv.querySelectorAll('.customization-category').forEach(categoryDiv => {
                    const categoryName = categoryDiv.querySelector('h3').textContent.toLowerCase();

                    if (categoryName === 'size') return;

                    const selectedOptions = [];

                    categoryDiv.querySelectorAll('input[type="radio"]:checked, input[type="checkbox"]:checked').forEach(input => {
                        const optionId = input.value;
                        const optionName = input.labels[0].textContent.split(' ($')[0].trim();
                        const optionPrice = parseFloat(input.dataset.price);
                        let quantity = 1;

                        if (input.type === 'checkbox' && categoryName === 'toppings' && input.checked) {
                            const quantitySelect = document.querySelector(`#qty-${optionId}-select`);
                            if (quantitySelect) {
                                quantity = parseInt(quantitySelect.value);
                            }
                        }

                        selectedOptions.push({
                            id: optionId,
                            name: optionName,
                            price: optionPrice,
                            quantity: quantity
                        });
                    });
                    if (selectedOptions.length > 0) {
                        selectedCustomizations[categoryName] = selectedOptions;
                    }
                });

                const customizedItemPrice = currentTotal;

                const uniqueCartId = `${baseItemId}-${Date.now()}`;

                const customizedItem = {
                    id: uniqueCartId,
                    cartId: uniqueCartId,
                    baseId: baseItemId,
                    name: pizzaName,
                    basePrice: basePrice,
                    customizations: selectedCustomizations,
                    price: customizedItemPrice,
                    quantity: 1
                };

                const currentOrder = JSON.parse(localStorage.getItem('cosmicOrder')) || [];

                currentOrder.push(customizedItem);

                localStorage.setItem('cosmicOrder', JSON.stringify(currentOrder));

                window.location.href = '/order';
            });

            updateAccountActions();
        });
    </script>

    <script src="/static/cart.js"></script>
</body>
</html>
